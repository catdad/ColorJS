<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-selector/core-selector.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">

<polymer-element name="cjs-drawer-tools">
    <template>
        <style>
        
            /** style sidebar inputs **/
            .section.title {
                font-weight: bold;
                display: block;
                margin: 8px 1em 5px;
                padding: 5px;
                border-bottom: 1px solid #898989;
            }

            .section span{
                width: 6em;
                display: inline-block;
                text-align: right;
            }

            input{
                margin: 5px;
                background-color: white;
                border: 1px solid #aaa;
                padding: 3px 4px;
                font-size: 1.2em;
                font-family: inherit;
                cursor: pointer;
            }
            
            input[type="number"]{ width: 5em; cursor: inherit; }

            /*** end style sidebar inputs ***/
        
            core-selector{
                padding: 5px 10px;
            }
            .core-selected{
                font-weight: bold;
            }
            .core-selected.expanding{
                background-color: #f1f1f1;
                border-radius: 4px;
            }
            .expanding { padding-right: 10px; }
            .expanding paper-slider{
                display: none;
            }
            .expanding.core-selected paper-slider{
                display: block;
            }
            
            [wide]{ width: 100%; }
        </style>
        
        <div class="section title">Quick Schemes</div>
        <core-selector id="quickSchemes" layout vertical class="expanding">
            <paper-button value="analog">Analog</paper-button>
            <paper-button value="triad">Triad</paper-button>
            <paper-button value="split">Split</paper-button>
            <paper-button value="complement">Complement</paper-button>
        </core-selector>
        
<!--
        <div class="section"><div class="title">Quick Schemes</div>
            <button onclick="calc('analog')">Analog</button>
            <button onclick="calc('triad')">Triad</button>
            <button onclick="calc('split')">Split</button>
            <button onclick="calc('complement')">Complement</button>
        </div>
-->
        
        <div class="section title">Single-Color Schemes</div>
        <core-selector id="singleSchemes" layout vertical>
            <div id="monochrome" class="expanding" layout vertical>
                <paper-button>Scale</paper-button>
                <paper-slider min="2" max="10" value="2" name="monochrome" editable wide></paper-slider>
            </div>
            <div id="monochromeLight" class="expanding" layout vertical>
                <paper-button>Lighter</paper-button>
                <paper-slider min="2" max="10" value="2" name="monochromeLight" editable wide></paper-slider>
            </div>
            <div id="monochromeDark" class="expanding" layout vertical>
                <paper-button>Darker</paper-button>
                <paper-slider min="2" max="10" value="2" name="monochromeDark" editable wide></paper-slider>
            </div>
        </core-selector>
        
        <div class="section title">Multi-Color Schemes</div>
        <core-selector id="multiSchemes" layout vertical>
            <div id="quadrat" class="expanding" layout vertical>
                <paper-button>Quadrat</paper-button>
                <paper-slider min="-180" max="180" value="0" step="10" name="quadrat" snap editable wide></paper-slider>
            </div>
            <div id="hueShift" class="expanding" layout vertical>
                <paper-button>Hue Shift</paper-button>
                <paper-slider min="0" max="360" value="0" name="hueShift" editable wide></paper-slider>
            </div>
            <div id="contrasts" class="expanding" layout vertical>
                <paper-button>Contrasts</paper-button>
                <paper-slider min="2" max="10" value="2" name="contrasts" editable wide></paper-slider>
            </div>
            <div id="diverging" class="expanding" layout vertical>
                <paper-button>Diverging</paper-button>
                <paper-slider min="3" max="10" value="3" name="diverging" editable wide></paper-slider>
            </div>
        </core-selector>
        
        
<!--
        <div class="section"><div class="title">Single-Color Schemes</div>
            <div class="input">
                <span>Scale</span>
                <input id="monochrome" type="number" min="0" max="10" placeholder="count" />
            </div>
            <div class="input">
                <span>Lighter</span>
                <input id="monochromeLight" type="number" min="0" max="10" placeholder="count" />
            </div>
            <div class="input">
                <span>Darker</span>
                <input id="monochromeDark" type="number" min="0" max="10" placeholder="count" />
            </div>
        </div>

        <div class="section"><div class="title">Multi-Color Schemes</div>
            <div class="input">
                <span>Quadrat</span>
                <input id="quadrat" type="number" min="-180" max="180" step="10" placeholder="degrees" />
            </div>
            <div class="input">
                <span>Hue Shift</span>
                <input id="hueShift" type="number" min="0" max="360" placeholder="degrees" />
            </div>
            <div class="input">
                <span>Contrasts</span>
                <input id="contrasts" type="number" min="0" max="10" placeholder="count" />
            </div>
            <div class="input">
                <span>Diverging</span>
                <input id="diverging" type="number" min="3" max="10" placeholder="count" />
            </div>
        </div>
-->
        
    </template>
    <script>
        Polymer("cjs-drawer-tools", {
            configMethods: ["hueShift", "contrasts", "diverging", "monochrome", "quadrat", "monochromeLight", "monochromeDark"],
            isReady: false,
            ready: function(){
                var that = this;
                //set listeners
                for (var i = 0; i < that.configMethods.length; i++){
                    that.$[that.configMethods[i]].oninput = function oninput(){
                        that.fireChanged(this.id, Number(this.value) );
                        that.resetInputs(this.id);
                    };
                }
                
                //Than listen to scheme type change
                this.$.quickSchemes.addEventListener("core-activate", function(ev){
                    that.sliderChangeRouter(ev, 'quickSchemes');
                    that.fireChanged(ev.detail.item.getAttribute('value'));
                });
                this.$.singleSchemes.addEventListener("core-activate", function(ev){
                    that.sliderChangeRouter(ev, 'singleSchemes');
                });
                this.$.multiSchemes.addEventListener("core-activate", function(ev){
                    that.sliderChangeRouter(ev, 'multiSchemes');
                });
                
                // listen to slider changes
                [].forEach.call(this.$.singleSchemes.querySelectorAll('paper-slider'), function(el){
                    el.addEventListener("change", function(ev){
                        that.isReady && that.fireChanged(el.getAttribute('name'), el.value);
                    });
                });
                
                [].forEach.call(this.$.multiSchemes.querySelectorAll('paper-slider'), function(el){
                    el.addEventListener("change", function(ev){
                        that.isReady && that.fireChanged(el.getAttribute('name'), el.value);
                    });
                });
                
                // set library to ready
                this.async(function(){ that.isReady = true; }, 0);
            },
            resetQuickSchemes: function(){
                this.$.quickSchemes.selected = undefined;
            },
            resetSingleSchemes: function(){
                this.$.singleSchemes.selected = undefined;
            },
            resetMultiSchemes: function(){
                this.$.multiSchemes.selected = undefined;
            },
            sliderChangeRouter: function sliderChangeRouter(ev, source){
                //only handle routes if ready
                if (!this.isReady) return;
                
                var that = this;
                
                function execute(arr){
                    arr.forEach(function(name){
                        that[name]();
                    });
                }
                
                switch (source) {
                    case 'quickSchemes':
                        execute(['resetSingleSchemes', 'resetMultiSchemes']);
                        break;
                    case 'singleSchemes':
                        execute(['resetQuickSchemes', 'resetMultiSchemes']);
                        var slider = ev.detail.item.querySelector('paper-slider')
                        console.log(slider.getAttribute('name'), slider.value);
                        that.fireChanged(slider.getAttribute('name'), slider.value);
                        break;
                    case 'multiSchemes':
                        execute(['resetQuickSchemes', 'resetSingleSchemes']);
                        var slider = ev.detail.item.querySelector('paper-slider')
                        that.fireChanged(slider.getAttribute('name'), slider.value);
                        break;
                }
            },
            fireChanged: function fireChanged(method, n){
                this.fire("change", { method: method, n: n });
            },
            resetInputs: function resetInputs(method){
                var that = this;
                for (var i = 0; i < that.configMethods.length; i++){
                    if (that.configMethods[i] !== method) that.$[that.configMethods[i]].value = "";
                }
                
                this.$.quickSchemes.selected = undefined;
            },
            publish: {
                getMethod: function(){
                
                },
                setMethod: function setMethod(method, n){
                    this.$[method].value = n;
                    this.fireChanged(method, n);
                },
                isValidMethod: function(method){
                    for (var i = this.configMethods.length-1; i > -1; i--){
                        if (this.configMethods[i] === method) return true;
                    }
                    return false;
                }
            }
        
        });
    </script>
</polymer-element>